<section>
  <div class="alert alert-warning" role="alert" *ngIf="getTotalItems() === 0">
    Search for projects to add to your collection.
  </div>

  <p class="alert alert-warning" *ngIf="resultDataSource.data.length === 0 && searched && !loadStatus()">No results
    found</p>

  <div class="box-padding">
    <form #form="ngForm">
      <div class="search_bar">
        <mat-form-field>
          <input type="text" matInput #query="ngModel" class="form-control" name="query" placeholder="use user:ownername for search by Repository Owner"
            required [(ngModel)]="model.query" class="search_align">
        </mat-form-field>
        <button mat-raised-button type="submit" [disabled]="query.value === '' || query === undefined" (click)="search(model.query)"
          class="btn-left-mrgn btn btn-success align-middle">Search</button>
        <span class="btn-left-mrgn">
          <button mat-raised-button class="btn btn-success btn-sm align-middle " (click)="isFilterVisible=true" *ngIf="!isFilterVisible">
            Show Filtering Options</button>
          <button mat-raised-button class="btn btn-sm btn-success" *ngIf="isFilterVisible" (click)="isFilterVisible=false">
            Hide
            Filtering Options</button>
        </span>
      </div>
    </form>
  </div>

<div *ngIf="filterDataSource.data.length > 0">
  <table mat-table [dataSource]="filterDataSource" class="mat-elevation-z8">
    <ng-container matColumnDef="filter">
      <th mat-header-cell *matHeaderCellDef>Filter</th>
      <td mat-cell *matCellDef="let row">{{row.filter}}</td>
    </ng-container>
    <ng-container matColumnDef="value">
      <th mat-header-cell *matHeaderCellDef>Value</th>
      <td mat-cell *matCellDef="let row">
        <input matInput [(ngModel)]="row.value" placeholder="> 1">
      </td>
    </ng-container>
    <ng-container matColumnDef="operand">
      <th mat-header-cell *matHeaderCellDef>Operand</th>
      <td mat-cell *matCellDef="let row">
        <mat-button-toggle-group [value]="row.operand" (change)="toggleOperand($event, row)">
          <mat-button-toggle value="&&">&&</mat-button-toggle>
          <mat-button-toggle value="||">||</mat-button-toggle>
        </mat-button-toggle-group>

      </td>
    </ng-container>
    <ng-container matColumnDef="action">
      <th mat-header-cell *matHeaderCellDef>Action</th>
      <td mat-cell *matCellDef="let row">
        <button mat-raised-button (click)="applyFilter(row)">Apply</button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="filterColumns"></tr>
    <tr mat-row *matRowDef="let rowDef; columns: filterColumns;"></tr>
  </table>

  <mat-paginator #filterPaginator [pageSizeOptions]="[5, 10, 20]" [length]="filterDataSource.data.length"
    showFirstLastButtons></mat-paginator>

</div>
 
  <!-- Search result list -->
  <div id="results" class="box-padding" *ngIf="resultDataSource.data.length>0">
    <h5>{{resultDataSource.data.length}} Result(s) </h5>
    <br>
    <mat-form-field *ngIf="isFilterVisible">
      <input matInput (keyup)="applyDataSourceFilter($event.target.value)" placeholder="Filter">
    </mat-form-field>
    <table #resultsTable mat-table matSort [dataSource]="resultDataSource" class="mat-elevation-z8">


      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Name. </th>
        <td mat-cell *matCellDef="let row"> {{row.name}} </td>
      </ng-container>

      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Description </th>
        <td mat-cell *matCellDef="let row"> {{row.description}} </td>
      </ng-container>

      <ng-container matColumnDef="creationDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Creation Date </th>
        <td mat-cell *matCellDef="let row"> {{row.creationDate | date:'short'}} </td>
      </ng-container>

      <ng-container matColumnDef="size">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Size </th>
        <td mat-cell *matCellDef="let row"> {{row.size | fileSize}} </td>
      </ng-container>
      <ng-container matColumnDef="htmlUrl">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Origin </th>
        <td mat-cell *matCellDef="let row"> {{row.htmlUrl | siteName}} </td>
      </ng-container>
      <!-- Checkbox Column -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox (change)="$event ? selectDeselectAll() : null" [checked]="selection.hasValue() &&  isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()">
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox (click)="null" (change)="$event ? select(row) : null" [checked]="selection.isSelected(row)"
            [(ngModel)]="row.singleSelection">
          </mat-checkbox>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="searchColumns"></tr>
      <tr mat-row *matRowDef="let rowDef; columns: searchColumns;"></tr>

    </table>

    <mat-paginator #resultPaginator [pageSizeOptions]="[5, 10, 20]" [length]="resultDataSource.data.length"
      showFirstLastButtons></mat-paginator>


  </div>

  <!-- Selected project list -->
  <div style="max-height:1000px;overflow:auto">
    <h5 class="float-left" style="margin-top:0px" *ngIf="getTotalItems() > 0"> {{getTotalItems() | projectCount }}
      Selected</h5>

    <div class="col-lg-12 text-right box-padding" *ngIf="getTotalItems()>0">
      <button mat-raised-button (click)="addAll()">Add Selected Projects to a existing Collection</button>
      <button mat-raised-button (click)="createCollection()">Create New Collection</button>
      <button mat-raised-button (click)="removeCart()">Remove all</button>
    </div>

    <div class="col-lg-12" *ngIf="getTotalItems()>0" style="max-height:600px">
      <table mat-table [dataSource]="toAdd" class="mat-elevation-z8">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Name. </th>
          <td mat-cell *matCellDef="let row"> {{row.name}} </td>
        </ng-container>

        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef> Description </th>
          <td mat-cell *matCellDef="let row"> {{row.description}} </td>
        </ng-container>

        <ng-container matColumnDef="creationDate">
          <th mat-header-cell *matHeaderCellDef> Creation Date </th>
          <td mat-cell *matCellDef="let row"> {{row.creationDate}} </td>
        </ng-container>

        <ng-container matColumnDef="size">
          <th mat-header-cell *matHeaderCellDef> Size </th>
          <td mat-cell *matCellDef="let row"> {{row.size}} </td>
        </ng-container>
        <ng-container matColumnDef="htmlUrl">
          <th mat-header-cell *matHeaderCellDef> Origin </th>
          <td mat-cell *matCellDef="let row"> {{row.htmlUrl}} </td>
        </ng-container>

        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
          </th>
          <td mat-cell *matCellDef="let row">
            <button mat-raised-button class="btn btn-sm btn-danger" (click)="removeItem(row)">Remove</button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="addColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: addColumns"></tr>
      </table>

    </div>


  </div>

  <!-- loading -->
  <div class="wrapper" *ngIf="loadStatus()">
    <h2>Searching</h2>
    <span class="cssload-loader"></span>
  </div>

</section>